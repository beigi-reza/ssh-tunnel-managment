# مدیریت تونل های ssh
![licence](https://img.shields.io/github/license/beigi-reza/ssh-tunnel-managment)

این برنامه برای مدیریت تونل های ssh توسعه داده شده است و بین دو سرورلینوکس یک اتصال امن با پایداری بالا ایجاد می کند . از اتصال ایجاد شده در برار اختلال های شبکه محافظت کرده و اگر به هر دلیلی ارتباط قطع شود برنامه مجددا اتصال  را بدون دخالت کاربر برقرار می کند. 

این برنامه می تواند محدودیت های شدید شبکه را دور بزند و دسترسی کاربر را به اینترنت آزاد مقدور سازد


## پیش نیاز ها

- پایتون نگارش 3.1
- فرمان autossh (برای حالت پیشرفته)

## اصطلاحات
-  سرور ها و نقش آنها
    - سرور بالادستی (Upstream Server):
        - سروری است که به اینترنت آزاد دسترسی دارد         
    - سرور رابط و یا پل (Bridge Server):
        -  سروری است که در شبکه محدود قرار دارد و کاربران به راحتی به آن دسترسی دارند 
    - کاربران (Client): 
        - کاربرانی که فقط به سرور رابط دسترسی دارند 

## مدل اتصال
هدف ما از اجرای این سناریو این است که در نهایت یک و یا چند پورت سرور بالادستی در سرور پل در اختیار کاربر قرار گیرد که از طریق آن به اینترنت آزاد دسترسی داشته باشد.

```
Client <-> Bridge Server <-> Upstream Server <-> Internet
```

بسته به روش و دلیل اجرا یکی از روش ها را انتخاب کنید

### اتصال محلی (Local)

اگر سرور رابط در اتصال به سرور بالادستی مشکلی ندارد و دسترسی به سرور بالادستی بدون مشکل می باشد روش اتصال لوکال توصیه می شود، در این روش نرم افزار در سرور رابط قرار گرفته و اتصال از نوع لوکال انجام می شود 

>اگر احتمال می دهید که با برقراری ارتباط امکان بلاک شدن آی پی سرور بالادستی وجود دارد برای اتصال از نوع ریموت استفاده کنید

```
Client <-> Bridge Server <-> Upstream Server <-> Internet
             ⬆️ ⬆️ ⬆️
 ```

فایل `conf/tunnel.json` را اصلاح کرده و یک سکشن مشابه مثال زیر در آن ایجاد کنید 

```json
        {
            "Name": "Tunnel Name 1",
            "Code": "t1",
            "ssh_ip" : "192.168.1.1",
            "ssh_user" : "root",
            "ssh_port" : "22",            
            "FinalPort": "3124",
            "Source_Server": "localhost",
            "Source_port": "3124",
            "Type" : "local",
            "Keep_Alive": true,
            "Highly_Restricted_Networks":{
                "Enable" : false,
                "ExitOnForwardFailure" :"yes",
                "ServerAliveInterval":60,
                "ServerAliveCountMax":3,
                "MonitorPort": 2000
            }                
```

## اتصال ریموت (Remote)

اگر سرور رابط در اتصال به سرور بالادستی مشکل دارد و یا آی پی سرور بالادستی فیلتر و یا بلاک شده است باید از اتصال ریموت استفاده کرد، 
در این روش نرم افزار در سرور بالادستی قرار گرفته و اتصال را با سرور رابط برقرار کرده و پورت نهایی در سرور رابط در اختیار کاربر قرار می گیرد 

```
Client <-> Bridge Server <-> Upstream Server <-> Internet
                                ⬆️ ⬆️ ⬆️
 ```


فایل `conf/tunnel.json` را اصلاح کرده و یک سکشن مشابه مثال زیر در آن ایجاد کنید 

```json
        {
            "Name": "Tunnel Name 2",
            "Code": "t2",
            "ssh_ip" : "192.168.2.2",
            "ssh_user" : "root",
            "ssh_port" : "22",            
            "FinalPort": "3124",
            "Source_Server": "localhost",
            "Source_port": "3124",
            "Type" : "remote",
            "Keep_Alive": true,
            "Highly_Restricted_Networks":{
                "Enable" : false,
                "ExitOnForwardFailure" :"yes",
                "ServerAliveInterval":60,
                "ServerAliveCountMax":3,
                "MonitorPort": 2000
            }                
```

- `Name`: نام تونل (این نام در لاگ ها و اطلاعات نمایش دادخ خواهد شد)
- `Code`: کد تونل (برای صدا زندن این تونل از این کد استفاده خواهد شد)
- `ssh_ip`: آی پی سرور مقصد (در حالت لوکال آی پی سرور بالادستی و در حالت ریموت آی پی سرور رابط)
- `ssh_user`: نام کاربری اس اس اچ
- `ssh_port`: پورت اس اس اچ
- `Source_port`: پورتی که می خواهیم در اختیار کاربران قرار گیرد
- `FinalPort`: پورتی که در نهایت در سرور رابط در اختار کاربران خواهد بود 
- `Type`: مدل اتصال را مشخص می کند 
